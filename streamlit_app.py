import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt

# --- –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ ---
st.set_page_config(
    page_title="–í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö",
    page_icon="üìä",
    layout="wide"  # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —à–∏—Ä–æ–∫–∏–π –º–∞–∫–µ—Ç –¥–ª—è –¥–∞–Ω–∏—Ö
)

# --- –ó–∞–≥–æ–ª–æ–≤–æ–∫ ---
st.title("üìä –ê–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏–π –í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Data Access)")
st.markdown("–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Å–≤—ñ–π CSV-—Ñ–∞–π–ª, —â–æ–± —Ä–æ–∑–ø–æ—á–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑ –¥–∞–Ω–∏—Ö.")

# --- –ë—ñ—á–Ω–∞ –ø–∞–Ω–µ–ª—å –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å ---
with st.sidebar:
    st.header("–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è")
    
    # 1. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º
    uploaded_file = st.file_uploader(
        "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ CSV —Ñ–∞–π–ª:",
        type=['csv']
    )
    st.markdown("---")
    st.info("–ü—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É –∑'—è–≤–ª—è—Ç—å—Å—è –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –æ–ø—Ü—ñ—ó.")

# --- –û–±—Ä–æ–±–∫–∞ –¥–∞–Ω–∏—Ö ---
if uploaded_file is not None:
    # –ó—á–∏—Ç—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
    try:
        df = pd.read_csv(uploaded_file)
        st.success("‚úÖ –§–∞–π–ª —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!")

        # --- –†–æ–∑–¥—ñ–ª 1: –ü–µ—Ä–µ–≥–ª—è–¥ –¥–∞–Ω–∏—Ö ---
        st.header("1. –ü–µ—Ä–µ–≥–ª—è–¥ –¥–∞–Ω–∏—Ö")
        st.write(f"–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π –Ω–∞–±—ñ—Ä –¥–∞–Ω–∏—Ö –º—ñ—Å—Ç–∏—Ç—å **{df.shape[0]} —Ä—è–¥–∫—ñ–≤** —Ç–∞ **{df.shape[1]} —Å—Ç–æ–≤–ø—Ü—ñ–≤**.")
        
        # –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–µ—Ä—à–∏—Ö 10 —Ä—è–¥–∫—ñ–≤
        st.dataframe(df.head(10))

        # --- –†–æ–∑–¥—ñ–ª 2: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è ---
        st.header("2. –°—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∏–π –æ–≥–ª—è–¥")
        st.write("–û—Å–Ω–æ–≤–Ω–∞ –æ–ø–∏—Å–æ–≤–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:")
        st.dataframe(df.describe())

        # –í–∏–±—ñ—Ä —Å—Ç–æ–≤–ø—Ü—è –¥–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó
        numerical_cols = df.select_dtypes(include=['number']).columns.tolist()
        
        if numerical_cols:
            st.subheader("–ì—ñ—Å—Ç–æ–≥—Ä–∞–º–∞ —Ä–æ–∑–ø–æ–¥—ñ–ª—É")
            
            # –î–æ–∑–≤–æ–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ –≤–∏–±—Ä–∞—Ç–∏ —Å—Ç–æ–≤–ø–µ—Ü—å
            selected_column = st.selectbox(
                "–û–±–µ—Ä—ñ—Ç—å —Å—Ç–æ–≤–ø–µ—Ü—å –¥–ª—è –ø–æ–±—É–¥–æ–≤–∏ –≥—ñ—Å—Ç–æ–≥—Ä–∞–º–∏:",
                numerical_cols
            )

            # –ü–æ–±—É–¥–æ–≤–∞ —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≥—ñ—Å—Ç–æ–≥—Ä–∞–º–∏
            fig, ax = plt.subplots()
            ax.hist(df[selected_column].dropna(), bins=20, edgecolor='black')
            ax.set_title(f"–†–æ–∑–ø–æ–¥—ñ–ª: {selected_column}")
            ax.set_xlabel(selected_column)
            ax.set_ylabel("–ß–∞—Å—Ç–æ—Ç–∞")
            st.pyplot(fig)
        else:
            st.warning("–£ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ–º—É —Ñ–∞–π–ª—ñ –Ω–µ–º–∞—î —á–∏—Å–ª–æ–≤–∏—Ö —Å—Ç–æ–≤–ø—Ü—ñ–≤ –¥–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó.")
            
    except Exception as e:
        st.error(f"‚ùå –í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –æ–±—Ä–æ–±–∫–∏ —Ñ–∞–π–ª—É: {e}")

else:
    st.info("–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ CSV-—Ñ–∞–π–ª —É –±—ñ—á–Ω—ñ–π –ø–∞–Ω–µ–ª—ñ, —â–æ–± —Ä–æ–∑–ø–æ—á–∞—Ç–∏ —Ä–æ–±–æ—Ç—É.")
    st.image("https://i.imgur.com/Kz8F0m2.png", caption="–Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≥–æ—Ç–æ–≤–∏–π –¥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö")
